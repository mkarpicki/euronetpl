(function(){ovi.provide("nokia.maps.gfx.CanvasPainter");
(function(){if(nokia.maps.dom.supportsCanvas&&!/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=!("naturalWidth"in new Image),k=nokia.maps.gfx,h=Math,d=h.sqrt,c=h.pow,h=k.Painter,g=k.IDL,b=k.Color,f=g.opcodes,q=g.identifierToAttribute,a=nokia.maps.util.d,a=nokia.maps.util.d,r=h.Ki,k=nokia.maps.gfx.CanvasPainter=new ovi.Class({Extends:nokia.maps.gfx.Painter,updateElement:function(a,b,c){this.Ea(a,b,b.ownerDocument);c=r(c);b.style.opacity=b.$n$opacity=c;b.$n$width=a.data[1];b.$n$height=a.data[2]},
createElement:function(a,b,c){b=(b||document).createElement("CANVAS");this.Ea(a,b);c=r(c);b.style.opacity=b.$n$opacity=c;b.$n$width=a.data[1];b.$n$height=a.data[2];return b},setOpacity:function(a,b){b=r(b);a.style.opacity=a.$n$opacity=b;return this},setScale:function(a,b){a.style.width=a.$n$width*b.x+"px";a.style.height=a.$n$height*b.y+"px"},Ea:function(b,c){var l;(!b||!b.data)&&a("CanvasPainter.createElement: Illegal IDL given");var d=b.data,g,e;d[0]!==f.BEGIN_2D_IMAGE&&a("CanvasPainter.createElement: Illegal opcode in IDL");
g=c.width=d[1];l=c.height=d[2],d=l;c.style.width=g+"px";c.style.height=d+"px";e=c.getContext("2d");e.clearRect(0,0,g,d);this.drawIDLToCanvas(b,e)},drawIDLToCanvas:function(g,h){(!g||!g.data)&&a("CanvasPainter.createElement: Illegal IDL given");var p=g.data,k,r,v,u,x,w,y,B,D,A,C=!0,E,M,H;p[0]!==f.BEGIN_2D_IMAGE&&a("CanvasPainter.createElement: Illegal opcode in IDL");k=3;h.save();for(h.lineCap="round";r=p[++k];)r===f.BEGIN_PATH?h.beginPath():r===f.MOVE_TO?h.moveTo(p[++k],p[++k]):r===f.LINE_TO?h.lineTo(p[++k],
p[++k]):r===f.BEZIER_CURVE_TO?h.bezierCurveTo(p[++k],p[++k],p[++k],p[++k],p[++k],p[++k]):r===f.FILL?(h.fill(),p[k+1]===f.STROKE&&(++k,C&&h.stroke())):r===f.STROKE?(C&&h.stroke(),p[k+1]===f.FILL&&(++k,h.fill())):r===f.SET?(r=q[p[++k]],y=p[++k],r==="fillColor"?h.fillStyle=b.getCssRGBA(y):r==="strokeColor"?h.strokeStyle=b.getCssRGBA(y):r==="opacity"?h.globalAlpha=+y:r!=="textBaseline"&&(r==="lineWidth"?C=(h[r]=y)!==0:r&&(h[r]=y))):r===f.DRAW_IMAGE||r===f.DRAW_IDL?(h.save(),y=p[++k],D=p[++k],v=p[++k],
w=p[++k],B=p[++k],x=p[++k],u=p[++k],M=p[++k],H=p[++k],A=p[++k],A=A.rows,h.transform(A[0][0],A[1][0],A[0][1],A[1][1],A[0][3],A[1][3]),r===f.DRAW_IMAGE&&y.nodeName!=="CANVAS"&&e?(E=new Image,E.src=y.src):E=y,A=E.naturalWidth||E.width,E=E.naturalHeight||E.height,A=(D+w>A?A-D:w)/w,E=(v+B>E?E-v:B)/B,r===f.DRAW_IMAGE?h.drawImage(y,D,v,w*A,B*E,x,u,M*A,H*E):(h.beginPath(),h.rect(x,u,M*A,H*E),h.clip(),A=M/w,E=H/B,h.translate(x-D*A,u-v*E),h.scale(A,E),this.drawIDLToCanvas(y,h)),h.restore()):r===f.SAVE?h.save():
r===f.RESTORE?h.restore():(y=r===f.FILL_TEXT,(D=r===f.STROKE_TEXT)||y?(w=p[++k],r=p[++k],v=p[++k],u=p[++k]-r,x=p[++k]-v,B=d(c(u,2)+c(x,2)),u/=B,x/=B,h.save(),h.transform(B*u,B*x,B*-x,B*u,r,v),y&&h.fillText(w,0,0),D&&h.strokeText(w,0,0),h.restore()):r===f.CLOSE_PATH&&h.closePath());h.restore()}});if(!h.defaultPainter)h.defaultPainter=k}})();ovi.provide("nokia.maps.gfx._packaging.package-canvas");})();
